<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OAuth 2.0 direct interation for native clients using federation</title>
<meta content="Yaron Zehavi" name="author">
<meta content="Aaron Parecki" name="author">
<meta content="
       OAuth 2.0 for First-Party Applications (FiPA)   defined native
OAuth 2.0  direct interaction , whereby clients call the  Native Authorization Endpoint 
as an HTTP REST API, obtaining instructions from authorization servers on information to
collect from users to satisfy authorization server's policies and requirements. 
       While FiPA   focused on a one-to-one relationship between
client and authorization server, this document acts as its  extension  adding support
for authorization servers to federate the interaction to a downstream authorization server,
instruct the usage of a native app for user interaction, or instruct collection of additional
information from users to guide request routing. 
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="native apps" name="keyword">
<meta content="first-party" name="keyword">
<meta content="oauth" name="keyword">
<meta content="draft-zehavi-oauth-native-clients-direct-interation-with-federation-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.12.12
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 6.0.2
    platformdirs 4.5.1
    pycountry 24.6.1
    PyYAML 6.0.3
    requests 2.32.5
    wcwidth 0.2.14
-->
<link href="draft-zehavi-oauth-native-clients-direct-interation-with-federation.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">OAuth native clients with federation</td>
<td class="right">December 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Zehavi &amp; Parecki</td>
<td class="center">Expires 26 June 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Web Authorization Protocol</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-zehavi-oauth-native-clients-direct-interation-with-federation-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-12-23" class="published">23 December 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-06-26">26 June 2026</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">Y. Zehavi</div>
<div class="org">Raiffeisen Bank International</div>
</div>
<div class="author">
      <div class="author-name">A. Parecki</div>
<div class="org">Okta</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OAuth 2.0 direct interation for native clients using federation</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">OAuth 2.0 for First-Party Applications (FiPA) <span>[<a href="#I-D.ietf-oauth-first-party-apps" class="cite xref">I-D.ietf-oauth-first-party-apps</a>]</span> defined native
OAuth 2.0 <strong>direct interaction</strong>, whereby clients call the <em>Native Authorization Endpoint</em>
as an HTTP REST API, obtaining instructions from authorization servers on information to
collect from users to satisfy authorization server's policies and requirements.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">While FiPA <span>[<a href="#I-D.ietf-oauth-first-party-apps" class="cite xref">I-D.ietf-oauth-first-party-apps</a>]</span> focused on a one-to-one relationship between
client and authorization server, this document acts as its <strong>extension</strong> adding support
for authorization servers to federate the interaction to a downstream authorization server,
instruct the usage of a native app for user interaction, or instruct collection of additional
information from users to guide request routing.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://yaron-zehavi.github.io/oauth-native-clients-direct-interation-with-federation/draft-zehavi-oauth-native-clients-direct-interation-with-federation.html">https://yaron-zehavi.github.io/oauth-native-clients-direct-interation-with-federation/draft-zehavi-oauth-native-clients-direct-interation-with-federation.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-zehavi-oauth-native-clients-direct-interation-with-federation/">https://datatracker.ietf.org/doc/draft-zehavi-oauth-native-clients-direct-interation-with-federation/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Web Authorization Protocol Working Group mailing list (<span><a href="mailto:oauth@ietf.org">mailto:oauth@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/oauth/">https://mailarchive.ietf.org/arch/browse/oauth/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/oauth/">https://www.ietf.org/mailman/listinfo/oauth/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/yaron-zehavi/oauth-native-clients-direct-interation-with-federation">https://github.com/yaron-zehavi/oauth-native-clients-direct-interation-with-federation</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 26 June 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-example-flow-native-client-" class="internal xref">Example flow: Native client federated and redirected to app</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-protocol-endpoints" class="internal xref">Protocol Endpoints</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-native-authorization-endpoi" class="internal xref">Native Authorization Endpoint</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-native-authorization-reques" class="internal xref">Native Authorization Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-native-authorization-respon" class="internal xref">Native Authorization Response</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.  <a href="#name-error-response" class="internal xref">Error Response</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-non-first-party-application" class="internal xref">Non First-Party applications of federated authorization servers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-oauth-parameters-registrati" class="internal xref">OAuth Parameters Registration</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-example-user-experiences" class="internal xref">Example User Experiences</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-native-client-federated-and" class="internal xref">Native client federated and redirected to app</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#appendix-A.1.1" class="auto internal xref">A.1.1</a>.  <a href="#name-diagram" class="internal xref">Diagram</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#appendix-A.1.2" class="auto internal xref">A.1.2</a>.  <a href="#name-client-makes-initial-reques" class="internal xref">Client makes initial request and receives "federate" error</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#appendix-A.1.3" class="auto internal xref">A.1.3</a>.  <a href="#name-client-calls-federated-auth" class="internal xref">Client calls federated authorization server and is redirected to app</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.4">
                    <p id="section-toc.1-1.8.2.1.2.4.1"><a href="#appendix-A.1.4" class="auto internal xref">A.1.4</a>.  <a href="#name-client-calls-federating-aut" class="internal xref">Client calls federating authorization server</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-usage-with-digital-credenti" class="internal xref">Usage with Digital Credentials</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#appendix-A.2.1" class="auto internal xref">A.2.1</a>.  <a href="#name-rar-transaction-data" class="internal xref">RAR &amp; Transaction Data</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-document-history" class="internal xref">Document History</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document, OAuth 2.0 direct interation for native clients using federation,
extends FiPA <span>[<a href="#I-D.ietf-oauth-first-party-apps" class="cite xref">I-D.ietf-oauth-first-party-apps</a>]</span> to enable federation based flows,
while retaining client's direct interaction with end-user.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The client calls the <em>Native Authorization Endpoint</em> as an HTTP REST API, and receives
instructions according to the protocol established by FiPA,
guiding client to call downstream authorization servers and providing their responses
to federating authorization servers. This establishes a multi authorization server
federated flow, whose user interactions are driven by the client app.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document extends FiPA <span>[<a href="#I-D.ietf-oauth-first-party-apps" class="cite xref">I-D.ietf-oauth-first-party-apps</a>]</span> with new error responses:
<code>federate</code>, <code>redirect_to_app</code>, <code>insufficient_information</code> and
<code>native_authorization_federate_unsupported</code>.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">It also adds additional response parameters:
<code>federation_uri</code>, <code>federation_body</code>, <code>response_uri</code>, <code>deep_link</code>.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">And adds the <code>native_callback_uri</code> request parameter.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protocol-overview">
<section id="section-3">
      <h2 id="name-protocol-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-3-1">There are three primary ways this specification extends FiPA:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">
          <p id="section-3-2.1.1"><code>federate</code> response: Sends the client to interact with a downstream authorization server.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.2">
          <p id="section-3-2.2.1"><code>insufficient_information</code> response: Instructs the client to collect information from end-user required to decide where to federate to. For example this could be an email address which identifies the trust domain.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.3">
          <p id="section-3-2.3.1"><code>redirect_to_app</code>: Instructs the client to natively invoke an app to interact with end user.<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="example-flow-native-client-federated-and-redirected-to-app">
<section id="section-3.1">
        <h3 id="name-example-flow-native-client-">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-example-flow-native-client-" class="section-name selfRef">Example flow: Native client federated and redirected to app</a>
        </h3>
<div class="alignLeft art-ascii-art art-text artwork" id="section-3.1-1">
<pre>
                                                +--------------------+
                                                |   Authorization    |
                          (B)Native             |      Server 1      |
             +----------+ Authorization Request |+------------------+|
(A)User  +---|          |----------------------&gt;||     Native       ||
   Starts|   |          |                       ||  Authorization   ||
   Flow  +--&gt;|  Client  |&lt;----------------------||    Endpoint      ||
             |          | (C)Federate Error     |+------------------+|
             |          |        Response       +--------------------+
             |          |         :
             |          |         :             +--------------------+
             |          |         :             |   Authorization    |
             |          | (D)Native             |      Server 2      |
             |          | Authorization Request |+------------------+|
             |          |----------------------&gt;||     Native       ||
             |          |                       ||  Authorization   ||
             |          |&lt;----------------------||    Endpoint      ||
             |          | (E) Redirect to       |+------------------+|
             |          |     App Response      +--------------------+
             |          |         :
             |          |         :             +--------------------+
             |          | (F) Invoke App        |                    |
             |          |----------------------&gt;|   Native App of    |
             |          |                       |   Auth Server 2    |
             |          |&lt;----------------------|                    |
             |          | (G)Authorization code +--------------------+
             |          |   For Auth Server 1
             |          |         :             +--------------------+
             |          |         :             |   Authorization    |
             |          | (H)Authorization Code |      Server 1      |
             |          |    For Auth Server 1  |+------------------+|
             |          |----------------------&gt;||    Response      ||
             |          |                       ||       Uri        ||
             |          |&lt;----------------------||    Endpoint      ||
             |          | (I) Authorization     |+------------------+|
             |          |     Code Response     |                    |
             |          |         :             |                    |
             |          |         :             |                    |
             |          | (J) Token Request     |+------------------+|
             |          |----------------------&gt;||      Token       ||
             |          |                       ||     Endpoint     ||
             |          |&lt;----------------------||                  ||
             |          | (K) Access Token      |+------------------+|
             |          |                       +--------------------+
             |          |
             +----------+
</pre><a href="#section-3.1-1" class="pilcrow">¶</a>
</div>
<p id="section-3.1-2">Figure: Native client federated, then redirected to app<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-3.1">
            <p id="section-3.1-3.1.1">(A) The client starts the flow.<a href="#section-3.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.2">
            <p id="section-3.1-3.2.1">(B) The client initiates the authorization request by making a POST request to the Native Authorization Endpoint of Authorization Server 1.<a href="#section-3.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.3">
            <p id="section-3.1-3.3.1">(C) Authorization Server 1 decides to federate the user to Authorization Server 2. To do so it contacts Authorization Server 2's PAR <span>[<a href="#RFC9126" class="cite xref">RFC9126</a>]</span> endpoint, then returns the <code>federate</code> error code together with the <em>federation_uri</em>, <em>federation_body</em>, <em>response_uri</em> and <em>auth_session</em> response attributes.<a href="#section-3.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.4">
            <p id="section-3.1-3.4.1">(D) The client calls Authorization Server 2's Native Authorization Endpoint, as instructed by Authorization Server 1.<a href="#section-3.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.5">
            <p id="section-3.1-3.5.1">(E) Authorization Server 2 decides to use a native app, and therefore responds with the <code>redirect_to_app</code> error code together with the <em>deep_link</em> response attribute.<a href="#section-3.1-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.6">
            <p id="section-3.1-3.6.1">(F) The client invokes the app using the deep_link.<a href="#section-3.1-3.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.7">
            <p id="section-3.1-3.7.1">(G) The app interacts with user and if satisifed, returns an authorization code, regarded as Authorization Server 2's response to Authorization Server 1's federation to it.<a href="#section-3.1-3.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.8">
            <p id="section-3.1-3.8.1">(H) The client provides the authorization code to Authorization Server 1.<a href="#section-3.1-3.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.9">
            <p id="section-3.1-3.9.1">(I) Authorization Server 1 returns an authorization code.<a href="#section-3.1-3.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.10">
            <p id="section-3.1-3.10.1">(J) The client sends the authorization code received in step (I) to obtain a token from the Token Endpoint.<a href="#section-3.1-3.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-3.11">
            <p id="section-3.1-3.11.1">(K) Authorization Server 1 returns an Access Token from the Token Endpoint.<a href="#section-3.1-3.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="protocol-endpoints">
<section id="section-4">
      <h2 id="name-protocol-endpoints">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-protocol-endpoints" class="section-name selfRef">Protocol Endpoints</a>
      </h2>
<div id="native-authorization-endpoint">
<section id="section-4.1">
        <h3 id="name-native-authorization-endpoi">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-native-authorization-endpoi" class="section-name selfRef">Native Authorization Endpoint</a>
        </h3>
<p id="section-4.1-1">The native authorization endpoint defined by FiPA <span>[<a href="#I-D.ietf-oauth-first-party-apps" class="cite xref">I-D.ietf-oauth-first-party-apps</a>]</span> is used by this document.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">This document adds the <em>native_callback_uri</em> parameter to the native authorization endpoint, to support
cross-app native user navigation.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">Before authorization servers instruct a client to federate to a downstream authorization server, they <span class="bcp14">MUST</span> ensure it offers a <em>native_authorization_endpoint</em>, otherwise return the error native_authorization_federate_unsupported*.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">When federating to downstream authorization servers, the usage of PAR <span>[<a href="#RFC9126" class="cite xref">RFC9126</a>]</span> with client authentication is <span class="bcp14">REQUIRED</span>, as the native client calling the Native Authorization Endpoint of a federated authorization server is not <em>its</em> OAuth client and therefore has no other means of authenticating.
When using PAR with client authentication, the request_uri provided to the Native Authorization Endpoint attests that client authentication took place.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="native-auth-request">
<section id="section-4.2">
        <h3 id="name-native-authorization-reques">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-native-authorization-reques" class="section-name selfRef">Native Authorization Request</a>
        </h3>
<p id="section-4.2-1">The native authorization endpoint is called as defined by FiPA <span>[<a href="#I-D.ietf-oauth-first-party-apps" class="cite xref">I-D.ietf-oauth-first-party-apps</a>]</span>.
This document adds the following request parameter:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.2-2">
          <dt id="section-4.2-2.1">"native_callback_uri":</dt>
          <dd style="margin-left: 1.5em" id="section-4.2-2.2">
            <p id="section-4.2-2.2.1"><span class="bcp14">OPTIONAL</span>. Native client app's <strong>redirect_uri</strong>, claimed as deep link. <em>native_callback_uri</em> <span class="bcp14">SHALL</span> be natively invoked by authorization server's user-interacting app to provide its response to the client app. If native_callback_uri is included in a native authorization request, authorization server <span class="bcp14">MUST</span> include the native_callback_uri when federating to another authorization server.<a href="#section-4.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="native-response">
<section id="section-4.3">
        <h3 id="name-native-authorization-respon">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-native-authorization-respon" class="section-name selfRef">Native Authorization Response</a>
        </h3>
<div id="native-authorization-error-response">
<section id="section-4.3.1">
          <h4 id="name-error-response">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-error-response" class="section-name selfRef">Error Response</a>
          </h4>
<p id="section-4.3.1-1">This document extends FiPA <span>[<a href="#I-D.ietf-oauth-first-party-apps" class="cite xref">I-D.ietf-oauth-first-party-apps</a>]</span> by adding the following error codes:<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.3.1-2">
            <dt id="section-4.3.1-2.1">"error":</dt>
            <dd style="margin-left: 1.5em" id="section-4.3.1-2.2">
              <p id="section-4.3.1-2.2.1"><span class="bcp14">REQUIRED</span>.  A single ASCII <span>[<a href="#USASCII" class="cite xref">USASCII</a>]</span> error code from the following:<a href="#section-4.3.1-2.2.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.3.1-2.2.2">
                <dt id="section-4.3.1-2.2.2.1">"insufficient_information":</dt>
                <dd style="margin-left: 1.5em" id="section-4.3.1-2.2.2.2">
                  <p id="section-4.3.1-2.2.2.2.1">the Authorization Server requires additional user input,
other than an authentication challenge, to determine the
target authorization server to federate to.
See <a href="#insufficient-information" class="auto internal xref">Section 4.3.1.3</a> for details.<a href="#section-4.3.1-2.2.2.2.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="section-4.3.1-2.2.2.3">"federate":</dt>
                <dd style="margin-left: 1.5em" id="section-4.3.1-2.2.2.4">
                  <p id="section-4.3.1-2.2.2.4.1">The Authorization Server wishes to federate to another
authorization server, which it is a client of. This
response <span class="bcp14">MUST</span> include the <em>federation_uri</em> response parameter.
See <a href="#federating-response" class="auto internal xref">Section 4.3.1.1</a> for details.<a href="#section-4.3.1-2.2.2.4.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="section-4.3.1-2.2.2.5">"redirect_to_app":</dt>
                <dd style="margin-left: 1.5em" id="section-4.3.1-2.2.2.6">
                  <p id="section-4.3.1-2.2.2.6.1">The Authorization Server wishes to fulfill the user interaction
using another native app. This response <span class="bcp14">MUST</span> include the
<em>federation_uri</em> response parameter.
See <a href="#redirect-to-app-response" class="auto internal xref">Section 4.3.1.2</a> for details.<a href="#section-4.3.1-2.2.2.6.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="section-4.3.1-2.2.2.7">"native_authorization_federate_unsupported":</dt>
                <dd style="margin-left: 1.5em" id="section-4.3.1-2.2.2.8">
                  <p id="section-4.3.1-2.2.2.8.1">The authorization server intended to federate to
a downstream authorization server, but it does not
support the native authorization endpoint.<a href="#section-4.3.1-2.2.2.8.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.3.1-3">And adds the following response attributes:<a href="#section-4.3.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.3.1-4">
            <dt id="section-4.3.1-4.1">"federation_uri":</dt>
            <dd style="margin-left: 1.5em" id="section-4.3.1-4.2">
              <p id="section-4.3.1-4.2.1"><span class="bcp14">OPTIONAL</span>.  The Native Authorization Endpoint of a downstream
authorization server to federate to.<a href="#section-4.3.1-4.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.3.1-4.3">"deep_link":</dt>
            <dd style="margin-left: 1.5em" id="section-4.3.1-4.4">
              <p id="section-4.3.1-4.4.1"><span class="bcp14">OPTIONAL</span>.  A URI of native app to be invoked to handle the request.<a href="#section-4.3.1-4.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.3.1-4.5">"federation_body":</dt>
            <dd style="margin-left: 1.5em" id="section-4.3.1-4.6">
              <p id="section-4.3.1-4.6.1"><span class="bcp14">OPTIONAL</span>.  A string of application/x-www-form-urlencoded
request parameters according to this specification for the
downstream authorization server's Native Authorization Endpoint.<a href="#section-4.3.1-4.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.3.1-4.7">"response_uri":</dt>
            <dd style="margin-left: 1.5em" id="section-4.3.1-4.8">
              <p id="section-4.3.1-4.8.1"><span class="bcp14">OPTIONAL</span>.  A URI of an endpoint of federating authorization server
which shall receive the response from the federated authorization server.<a href="#section-4.3.1-4.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<div id="federating-response">
<section id="section-4.3.1.1">
            <h5 id="name-federating-response">
<a href="#section-4.3.1.1" class="section-number selfRef">4.3.1.1. </a><a href="#name-federating-response" class="section-name selfRef">Federating Response</a>
            </h5>
<p id="section-4.3.1.1-1">If the authorization server decides to federate to another authorization server, it
responds with error code <em>federate</em> and <span class="bcp14">MUST</span> return the <em>federation_uri</em>,
<em>federation_body</em>, <em>response_uri</em> and <em>auth_session</em> response attributes.<a href="#section-4.3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-2">When federating to another authorization server:
* Federating authorization server <span class="bcp14">MUST</span> use PAR <span>[<a href="#RFC9126" class="cite xref">RFC9126</a>]</span> and include <em>request_uri</em> in federation_body.
* If <em>native_callback_uri</em> was included in the native authorization request, it <span class="bcp14">MUST</span> be included when calling federated authorization server's Native Authorization Endpoint.<a href="#section-4.3.1.1-2" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-3">Example <strong>federating</strong> response:<a href="#section-4.3.1.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.1-4">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
    "error": "federate",
    "auth_session": "ce6772f5e07bc8361572f",
    "response_uri": "https://prev-as.com/native-authorization",
    "federation_uri": "https://next-as.com/native-authorization",
    "federation_body": "client_id=s6BhdRkqt3&amp;request_uri=
      urn:ietf:params:oauth:request_uri:R3p_hzwsR7outNQSKfoX"
}
</pre><a href="#section-4.3.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.1-5">Client <span class="bcp14">MUST</span> call the <em>federation_uri</em> using HTTP POST, and provide it <em>federation_body</em>
as application/x-www-form-urlencoded request body. Example:<a href="#section-4.3.1.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.1-6">
<pre>
POST /native-authorization HTTP/1.1
Host: next-as.com
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;request_uri=
urn:ietf:params:oauth:request_uri:R3p_hzwsR7outNQSKfoX
</pre><a href="#section-4.3.1.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.1-7">The client <span class="bcp14">MUST</span> provide any response obtained from the <strong>federated</strong> authorization server,
as application/x-www-form-urlencoded request body for the <em>response_uri</em> of the respective
<strong>federating</strong> authorization server which <span class="bcp14">SHALL</span> be invoked using HTTP POST.<a href="#section-4.3.1.1-7" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-8">However, when <strong>federated</strong> authorization server returns the following error codes:
<em>federate</em>, <em>insufficient_authorization</em>, <em>insufficient_information</em>, <em>redirect_to_app</em>,
<em>redirect_to_web</em>, client <span class="bcp14">MUST</span> handle these errors according to this specification.<a href="#section-4.3.1.1-8" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-9">Example client calling receiving an authorization code response from the federated
authorization server:<a href="#section-4.3.1.1-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.1-10">
<pre>
HTTP/1.1 200 OK
Server: next-as.com
Content-Type: application/json
Cache-Control: no-store

{
  "authorization_code": "uY29tL2F1dGhlbnRpY"
}
</pre><a href="#section-4.3.1.1-10" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.1-11">And providing it to the federating authorization server's response_uri,
adding previously obtained auth_session:<a href="#section-4.3.1.1-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.1-12">
<pre>
POST /native-authorization HTTP/1.1
Host: prev-as.com
Content-Type: application/x-www-form-urlencoded

authorization_code=uY29tL2F1dGhlbnRpY
&amp;auth_session=ce6772f5e07bc8361572f
</pre><a href="#section-4.3.1.1-12" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="redirect-to-app-response">
<section id="section-4.3.1.2">
            <h5 id="name-redirect-to-app-response">
<a href="#section-4.3.1.2" class="section-number selfRef">4.3.1.2. </a><a href="#name-redirect-to-app-response" class="section-name selfRef">Redirect to app response</a>
            </h5>
<p id="section-4.3.1.2-1">If the authorization server decides to use a native app to interact with
end user, it responds with error code <em>redirect_to_app</em> and <span class="bcp14">MUST</span> return the
<em>deep_link</em> response attribute.<a href="#section-4.3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.2-2">Example <strong>redirect_to_app</strong> response:<a href="#section-4.3.1.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.2-3">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
    "error": "redirect_to_app",
    "deep_link": "https://next-as.com/native-authorization?
      client_id=s6BhdRkqt3&amp;request_uri=
      urn:ietf:params:oauth:request_uri:R3p_hzwsR7outNQSKfoX"
}
</pre><a href="#section-4.3.1.2-3" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.2-4">Client <span class="bcp14">MUST</span> use OS mechanisms to invoke the obtained deep_link.
If no app claiming deep_link is found on the device, client <span class="bcp14">MUST</span> terminate the
flow and <span class="bcp14">MAY</span> attempt a normal non-native OAuth flow.<a href="#section-4.3.1.2-4" class="pilcrow">¶</a></p>
<p id="section-4.3.1.2-5">The invoked app handles the native authorization request:<a href="#section-4.3.1.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1.2-6.1">
                <p id="section-4.3.1.2-6.1.1">Validates the request and ensures it contains a <em>native_callback_uri</em>, Otherwise terminates the flow.<a href="#section-4.3.1.2-6.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.3.1.2-6.2">
                <p id="section-4.3.1.2-6.2.1">Establishes trust in <em>native_callback_uri</em> and validates that an app claiming it is on the device. Otherwise terminates the flow.<a href="#section-4.3.1.2-6.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.3.1.2-6.3">
                <p id="section-4.3.1.2-6.3.1">Authenticates end-user and authorizes the request.<a href="#section-4.3.1.2-6.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.3.1.2-6.4">
                <p id="section-4.3.1.2-6.4.1">Uses OS mechanisms to natively invoke <em>native_callback_uri</em> and return to the client, providing it a response according to this specification's response from a Native Authorization Endpoint, as url-encoded query parameters.<a href="#section-4.3.1.2-6.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.3.1.2-7">Note - trust establishment mechanisms in <em>native_callback_uri</em> are out of scope of this specification.
However we assume closed ecosystems could employ an allowList, and open ecosystems could leverage
<span>[<a href="#OpenID.Federation" class="cite xref">OpenID.Federation</a>]</span>:<a href="#section-4.3.1.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1.2-8.1">
                <p id="section-4.3.1.2-8.1.1">Extract native_callback_uri's DNS domain.<a href="#section-4.3.1.2-8.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.3.1.2-8.2">
                <p id="section-4.3.1.2-8.2.1">Add the path /.well-known/openid-federation and perform trust chain resolution.<a href="#section-4.3.1.2-8.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.3.1.2-8.3">
                <p id="section-4.3.1.2-8.3.1">Inspect client's metadata for redirect_uri's and validate <strong>native_callback_uri</strong> is included among them.<a href="#section-4.3.1.2-8.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.3.1.2-9">When the client is invoked on its native_callback_uri, it shall regard the invocation as a
response <strong>from</strong> the authorization server which redirected the client to the app.
In other words, this response's audience is not the authorization server which redirected
the client to the app. See <a href="#federating-response" class="auto internal xref">Section 4.3.1.1</a> for details.<a href="#section-4.3.1.2-9" class="pilcrow">¶</a></p>
<p id="section-4.3.1.2-10">Example URI used to invoke of client app on its claimed native_callback_uri:<a href="#section-4.3.1.2-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.2-11">
<pre>
https://client.example.com/cb?authorization_code=uY29tL2F1dGhlbnRpY
</pre><a href="#section-4.3.1.2-11" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.2-12">Example client invoking the response_uri <strong>of the authorization server which federated it</strong>
to the authorization server, which redirected it to the app:<a href="#section-4.3.1.2-12" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.2-13">
<pre>
POST /native-authorization HTTP/1.1
Host: **prev-as.com**
Content-Type: application/x-www-form-urlencoded

authorization_code=uY29tL2F1dGhlbnRpY
&amp;auth_session=ce6772f5e07bc8361572f
</pre><a href="#section-4.3.1.2-13" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="insufficient-information">
<section id="section-4.3.1.3">
            <h5 id="name-additional-information-requ">
<a href="#section-4.3.1.3" class="section-number selfRef">4.3.1.3. </a><a href="#name-additional-information-requ" class="section-name selfRef">Additional Information Required Response</a>
            </h5>
<p id="section-4.3.1.3-1">If additional user input is required, for example to determine where to federate to,
the response body shall contain the following additional properties:<a href="#section-4.3.1.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.3.1.3-2">
              <dt id="section-4.3.1.3-2.1">logo:</dt>
              <dd style="margin-left: 1.5em" id="section-4.3.1.3-2.2">
                <p id="section-4.3.1.3-2.2.1"><span class="bcp14">OPTIONAL</span>. URL or base64-encoded logo of <em>Authorization Server</em>, for branding purposes.<a href="#section-4.3.1.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
<dt id="section-4.3.1.3-2.3">userPrompt:</dt>
              <dd style="margin-left: 1.5em" id="section-4.3.1.3-2.4">
                <p id="section-4.3.1.3-2.4.1"><span class="bcp14">REQUIRED</span>. A JSON object containing the prompt definition. The following parameters <span class="bcp14">MAY</span> be used:<a href="#section-4.3.1.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
</dl>
<ul class="normal">
<li class="normal" id="section-4.3.1.3-3.1">
                <p id="section-4.3.1.3-3.1.1">options: <span class="bcp14">OPTIONAL</span>. A JSON object that defines a dropdown/select input with various options to choose from. Each key is the parameter name to be sent in the response and each value defines the option:<a href="#section-4.3.1.3-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1.3-3.1.2.1">
                    <p id="section-4.3.1.3-3.1.2.1.1">title: <span class="bcp14">OPTIONAL</span>. A string holding the input's title.<a href="#section-4.3.1.3-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.3.1.3-3.1.2.2">
                    <p id="section-4.3.1.3-3.1.2.2.1">description: <span class="bcp14">OPTIONAL</span>. A string holding the input's description.<a href="#section-4.3.1.3-3.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.3.1.3-3.1.2.3">
                    <p id="section-4.3.1.3-3.1.2.3.1">values: <span class="bcp14">REQUIRED</span>. A JSON object where each key is the selection value and each value holds display data for that value:<a href="#section-4.3.1.3-3.1.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1.3-3.1.2.3.2.1">
                        <p id="section-4.3.1.3-3.1.2.3.2.1.1">name: <span class="bcp14">REQUIRED</span>. A string holding the display name of the selection value.<a href="#section-4.3.1.3-3.1.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                      <li class="normal" id="section-4.3.1.3-3.1.2.3.2.2">
                        <p id="section-4.3.1.3-3.1.2.3.2.2.1">logo: <span class="bcp14">OPTIONAL</span>. A string holding a URL or base64-encoded image for that selection value.<a href="#section-4.3.1.3-3.1.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li class="normal" id="section-4.3.1.3-3.2">
                <p id="section-4.3.1.3-3.2.1">inputs: <span class="bcp14">OPTIONAL</span>. A JSON object that defines an input field. Each key is the parameter name to be sent in the response and each value defines the input field:<a href="#section-4.3.1.3-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1.3-3.2.2.1">
                    <p id="section-4.3.1.3-3.2.2.1.1">title: <span class="bcp14">OPTIONAL</span>. A string holding the input's title.<a href="#section-4.3.1.3-3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.3.1.3-3.2.2.2">
                    <p id="section-4.3.1.3-3.2.2.2.1">hint: <span class="bcp14">OPTIONAL</span>. A string holding the input's hint that is displayed if the input is empty.<a href="#section-4.3.1.3-3.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.3.1.3-3.2.2.3">
                    <p id="section-4.3.1.3-3.2.2.3.1">description: <span class="bcp14">OPTIONAL</span>. A string holding the input's description.<a href="#section-4.3.1.3-3.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
<p id="section-4.3.1.3-4">Example of requesting end-user for 2 multiple-choice inputs:<a href="#section-4.3.1.3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.3-5">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
    "error": "insufficient_information",
    "auth_session": "ce6772f5e07bc8361572f",
    "logo": "uri or base64-encoded logo of Authorization Server",
    "userPrompt": {
        "options": {
            "bank": {
                "title": "Bank",
                "description": "Choose your Bank",
                "values": {
                    "bankOfSomething": {
                        "name": "Bank of Something",
                        "logo": "uri or base64-encoded logo"
                    },
                    "firstBankOfCountry": {
                        "name": "First Bank of Country",
                        "logo": "uri or base64-encoded logo"
                    }
                }
            },
            "segment": {
                "title": "Customer Segment",
                "description": "Choose your Customer Segment",
                "values": {
                    "retail": "Retail",
                    "smb": "Small &amp; Medium Businesses",
                    "corporate": "Corporate",
                    "ic": "Institutional Clients"
                }
            }
        }
    }
}
</pre><a href="#section-4.3.1.3-5" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.3-6">Example of requesting end-user for text input entry (email):<a href="#section-4.3.1.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.3-7">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
    "error": "insufficient_information",
    "auth_session": "ce6772f5e07bc8361572f",
    "action": "prompt",
    "id": "request-identifier-2",
    "logo": "uri or base64-encoded logo of Authorization Server",
    "userPrompt": {
        "inputs": {
            "email": {
                "hint": "Enter your email address",
                "title": "E-Mail",
                "description": "Lorem Ipsum"
            }
        }
    }
}
</pre><a href="#section-4.3.1.3-7" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.3-8">The client gathers the required additional information and makes a POST request to the Native Authorization Endpoint. Example of response following end-user multiple-choice:<a href="#section-4.3.1.3-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.3-9">
<pre>
POST /native-authorization HTTP/1.1
Host: example.as.com
Content-Type: application/x-www-form-urlencoded

auth_session=ce6772f5e07bc8361572f
&amp;bank=bankOfSomething
&amp;segment=retail
</pre><a href="#section-4.3.1.3-9" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.3-10">Example of <em>Client App</em> response following end-user input entry:<a href="#section-4.3.1.3-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.3-11">
<pre>
POST /native-authorization HTTP/1.1
Host: example.as.com
Content-Type: application/x-www-form-urlencoded

auth_session=ce6772f5e07bc8361572f
&amp;email=end_user@example.as.com
</pre><a href="#section-4.3.1.3-11" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="first-party-applications">
<section id="section-5.1">
        <h3 id="name-non-first-party-application">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-non-first-party-application" class="section-name selfRef">Non First-Party applications of federated authorization servers</a>
        </h3>
<p id="section-5.1-1">A federated authorization server should consider end-user's privacy and security
to determine if it should present authorization challenges in federation scenarios.
For example, it can label <strong>federating</strong> clients as such and avoid serving them
authorization challenges, as user-serving clients receiving those challenges are
not first party clients.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="oauth-parameters-registration">
<section id="section-6.1">
        <h3 id="name-oauth-parameters-registrati">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-oauth-parameters-registrati" class="section-name selfRef">OAuth Parameters Registration</a>
        </h3>
<p id="section-6.1-1">IANA has (TBD) registered the following values in the IANA "OAuth Parameters" registry of <span>[<a href="#IANA.oauth-parameters" class="cite xref">IANA.oauth-parameters</a>]</span> established by <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2"><strong>Parameter name</strong>: <code>native_callback_uri</code><a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3"><strong>Parameter usage location</strong>: Native Authorization Endpoint<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4"><strong>Change Controller</strong>: IETF<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5"><strong>Specification Document</strong>: Section 5.4 of this specification<a href="#section-6.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-normative-references">
<section id="section-7">
      <h2 id="name-normative-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="I-D.ietf-oauth-first-party-apps">[I-D.ietf-oauth-first-party-apps]</dt>
      <dd>
<span class="refAuthor">Parecki, A.</span>, <span class="refAuthor">Fletcher, G.</span>, and <span class="refAuthor">P. Kasselman</span>, <span class="refTitle">"OAuth 2.0 for First-Party Applications"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-first-party-apps-02</span>, <time datetime="2025-10-20" class="refDate">20 October 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-first-party-apps-02">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-first-party-apps-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA.oauth-parameters">[IANA.oauth-parameters]</dt>
      <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"OAuth Parameters"</span>, <span>&lt;<a href="https://www.iana.org/assignments/oauth-parameters">https://www.iana.org/assignments/oauth-parameters</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OpenID.Federation">[OpenID.Federation]</dt>
      <dd>
<span class="refAuthor">Hedberg, Ed, R.</span>, <span class="refAuthor">Jones, M. B.</span>, <span class="refAuthor">Solberg, A. A.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">De Marco, G.</span>, and <span class="refAuthor">V. Dzhuvinov</span>, <span class="refTitle">"OpenID Federation 1.0"</span>, <time datetime="2025-03" class="refDate">March 2025</time>, <span>&lt;<a href="https://openid.net/specs/openid-federation-1_0.html">https://openid.net/specs/openid-federation-1_0.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OpenID4VP">[OpenID4VP]</dt>
      <dd>
<span class="refAuthor">Terbu, O.</span>, <span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Yasuda, K.</span>, <span class="refAuthor">Fett, D.</span>, and <span class="refAuthor">J. Heenan</span>, <span class="refTitle">"OpenID for Verifiable Presentations 1.0"</span>, <time datetime="2025-07" class="refDate">July 2025</time>, <span>&lt;<a href="https://openid.net/specs/openid-4-verifiable-presentations-1_0.html">https://openid.net/specs/openid-4-verifiable-presentations-1_0.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
      <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6749">https://www.rfc-editor.org/rfc/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9126">[RFC9126]</dt>
      <dd>
<span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Campbell, B.</span>, <span class="refAuthor">Sakimura, N.</span>, <span class="refAuthor">Tonge, D.</span>, and <span class="refAuthor">F. Skokan</span>, <span class="refTitle">"OAuth 2.0 Pushed Authorization Requests"</span>, <span class="seriesInfo">RFC 9126</span>, <span class="seriesInfo">DOI 10.17487/RFC9126</span>, <time datetime="2021-09" class="refDate">September 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9126">https://www.rfc-editor.org/rfc/rfc9126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9396">[RFC9396]</dt>
      <dd>
<span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Richer, J.</span>, and <span class="refAuthor">B. Campbell</span>, <span class="refTitle">"OAuth 2.0 Rich Authorization Requests"</span>, <span class="seriesInfo">RFC 9396</span>, <span class="seriesInfo">DOI 10.17487/RFC9396</span>, <time datetime="2023-05" class="refDate">May 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9396">https://www.rfc-editor.org/rfc/rfc9396</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="USASCII">[USASCII]</dt>
    <dd>
<span class="refAuthor">Institute, A. N. S.</span>, <span class="refTitle">"Coded Character Set -- 7-bit American Standard Code for Information Interchange, ANSI X3.4"</span>, <time datetime="1986" class="refDate">1986</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="example-user-experiences">
<section id="appendix-A">
      <h2 id="name-example-user-experiences">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-example-user-experiences" class="section-name selfRef">Example User Experiences</a>
      </h2>
<p id="appendix-A-1">This section provides non-normative examples of how this specification may be used to support specific use cases.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div id="native-client-federated-and-redirected-to-app">
<section id="appendix-A.1">
        <h3 id="name-native-client-federated-and">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-native-client-federated-and" class="section-name selfRef">Native client federated and redirected to app</a>
        </h3>
<div id="diagram">
<section id="appendix-A.1.1">
          <h4 id="name-diagram">
<a href="#appendix-A.1.1" class="section-number selfRef">A.1.1. </a><a href="#name-diagram" class="section-name selfRef">Diagram</a>
          </h4>
<div class="alignLeft art-ascii-art art-text artwork" id="appendix-A.1.1-1">
<pre>
                                                +--------------------+
                                                |   Authorization    |
                          (B)Native             |      Server 1      |
             +----------+ Authorization Request |+------------------+|
(A)User  +---|          |----------------------&gt;||     Native       ||
   Starts|   |          |                       ||  Authorization   ||
   Flow  +--&gt;|  Client  |&lt;----------------------||    Endpoint      ||
             |          | (C)Federate Error     |+------------------+|
             |          |        Response       +--------------------+
             |          |         :
             |          |         :             +--------------------+
             |          |         :             |   Authorization    |
             |          | (D)Native             |      Server 2      |
             |          | Authorization Request |+------------------+|
             |          |----------------------&gt;||     Native       ||
             |          |                       ||  Authorization   ||
             |          |&lt;----------------------||    Endpoint      ||
             |          | (E) Redirect to       |+------------------+|
             |          |     App Response      +--------------------+
             |          |         :
             |          |         :             +--------------------+
             |          | (F) Invoke App        |                    |
             |          |----------------------&gt;|   Native App of    |
             |          |                       |   Auth Server 2    |
             |          |&lt;----------------------|                    |
             |          | (G)Authorization code +--------------------+
             |          |   For Auth Server 1
             |          |         :             +--------------------+
             |          |         :             |   Authorization    |
             |          | (H)Authorization Code |      Server 1      |
             |          |    For Auth Server 1  |+------------------+|
             |          |----------------------&gt;||    Response      ||
             |          |                       ||       Uri        ||
             |          |&lt;----------------------||    Endpoint      ||
             |          | (I) Authorization     |+------------------+|
             |          |     Code Response     |                    |
             |          |         :             |                    |
             |          |         :             |                    |
             |          | (J) Token Request     |+------------------+|
             |          |----------------------&gt;||      Token       ||
             |          |                       ||     Endpoint     ||
             |          |&lt;----------------------||                  ||
             |          | (K) Access Token      |+------------------+|
             |          |                       +--------------------+
             |          |
             +----------+
</pre><a href="#appendix-A.1.1-1" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.1-2">Figure: Native client federated, then redirected to app<a href="#appendix-A.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-makes-initial-request-and-receives-federate-error">
<section id="appendix-A.1.2">
          <h4 id="name-client-makes-initial-reques">
<a href="#appendix-A.1.2" class="section-number selfRef">A.1.2. </a><a href="#name-client-makes-initial-reques" class="section-name selfRef">Client makes initial request and receives "federate" error</a>
          </h4>
<p id="appendix-A.1.2-1">Client calls the native authorization endpoint and includes the <em>native_callback_uri</em> parameter:<a href="#appendix-A.1.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.2-2">
<pre>
POST /native-authorization HTTP/1.1
Host: as-1.com
Content-Type: application/x-www-form-urlencoded

client_id=t7CieSlru4&amp;native_callback_uri=
https://client.example.com/cb
</pre><a href="#appendix-A.1.2-2" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.2-3">The first authorization server, as-1.com, decides to federate to as-2.com after validating
it supports the native authorization endpoint. If it does not, as-1.com returns:<a href="#appendix-A.1.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.2-4">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
    "error": "native_authorization_federate_unsupported"
}
</pre><a href="#appendix-A.1.2-4" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.2-5">If native authorization endpoint is supported by the federated authorization server,
as-1.com performs a PAR <span>[<a href="#RFC9126" class="cite xref">RFC9126</a>]</span> request to as-2.com's pushed authorization endpoint,
including the original <em>native_callback_uri</em>:<a href="#appendix-A.1.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.2-6">
<pre>
POST /par HTTP/1.1
Host: as-2.com
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;native_callback_uri=
https://client.example.com/cb
</pre><a href="#appendix-A.1.2-6" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.2-7">as-1.com receives a request_uri from as-2.com's PAR endpoint, which it
includes in its response to client, in the <em>federation_body</em> attribute:<a href="#appendix-A.1.2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.2-8">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
    "error": "federate",
    "auth_session": "ce6772f5e07bc8361572f",
    "response_uri": "https://as-1.com/native-authorization",
    "federation_uri": "https://as-2.com/native-authorization",
    "federation_body": "client_id=s6BhdRkqt3&amp;request_uri=
      urn:ietf:params:oauth:request_uri:R3p_hzwsR7outNQSKfoX"
}
</pre><a href="#appendix-A.1.2-8" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.2-9">See <a href="#federating-response" class="auto internal xref">Section 4.3.1.1</a> for more details.<a href="#appendix-A.1.2-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-calls-federated-authorization-server-and-is-redirected-to-app">
<section id="appendix-A.1.3">
          <h4 id="name-client-calls-federated-auth">
<a href="#appendix-A.1.3" class="section-number selfRef">A.1.3. </a><a href="#name-client-calls-federated-auth" class="section-name selfRef">Client calls federated authorization server and is redirected to app</a>
          </h4>
<p id="appendix-A.1.3-1">Client calls the <em>federation_uri</em> it got from as-1.com using HTTP POST with
<em>federation_body</em> as application/x-www-form-urlencoded request body:<a href="#appendix-A.1.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.3-2">
<pre>
POST /native-authorization HTTP/1.1
Host: as-2.com
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;request_uri=
urn:ietf:params:oauth:request_uri:R3p_hzwsR7outNQSKfoX
</pre><a href="#appendix-A.1.3-2" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.3-3">as-2.com decides to use its native app to interact with end-user and responds:<a href="#appendix-A.1.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.3-4">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
    "error": "redirect_to_app",
    "deep_link": "https://as-2.com/native-authorization?
      client_id=s6BhdRkqt3&amp;request_uri=
      urn:ietf:params:oauth:request_uri:R3p_hzwsR7outNQSKfoX"
}
</pre><a href="#appendix-A.1.3-4" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.3-5">Client locates an app claiming the obtained deep_link and invokes it.
See <a href="#redirect-to-app-response" class="auto internal xref">Section 4.3.1.2</a> for more details.
The invoked app handles the native authorization request and then natively invokes native_callback_uri:<a href="#appendix-A.1.3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.3-6">
<pre>
https://client.example.com/cb?authorization_code=uY29tL2F1dGhlbnRpY
</pre><a href="#appendix-A.1.3-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="client-calls-federating-authorization-server">
<section id="appendix-A.1.4">
          <h4 id="name-client-calls-federating-aut">
<a href="#appendix-A.1.4" class="section-number selfRef">A.1.4. </a><a href="#name-client-calls-federating-aut" class="section-name selfRef">Client calls federating authorization server</a>
          </h4>
<p id="appendix-A.1.4-1">Client invokes the response_uri of as-1.com as it is the authorization server which federated
it to as-2.com and the app's response is regarded as the response of as-2.com:<a href="#appendix-A.1.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.4-2">
<pre>
POST /native-authorization HTTP/1.1
Host: as-1.com
Content-Type: application/x-www-form-urlencoded

authorization_code=uY29tL2F1dGhlbnRpY
&amp;auth_session=ce6772f5e07bc8361572f
</pre><a href="#appendix-A.1.4-2" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.4-3">And receives in response an authorization code, which it is the audience of (no further federations) to resolve:<a href="#appendix-A.1.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1.4-4">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "authorization_code": "vZ3:uM3G2eHimcoSqjZ"
}
</pre><a href="#appendix-A.1.4-4" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1.4-5">Client proceeds to exchange code for tokens.<a href="#appendix-A.1.4-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="digital-credentials">
<section id="appendix-A.2">
        <h3 id="name-usage-with-digital-credenti">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-usage-with-digital-credenti" class="section-name selfRef">Usage with Digital Credentials</a>
        </h3>
<p id="appendix-A.2-1">Digital credentials (stored in wallets) may be used by authorization servers to authenticate a user or approve a transaction. This example flow shows how wallet credential presentation can be incorporated into this spec using DC API/<span>[<a href="#OpenID4VP" class="cite xref">OpenID4VP</a>]</span>.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-ascii-art art-text artwork" id="appendix-A.2-2">
<pre>
User            First Party Client        AS               Wallet/DC API        Verifier
----            ------------------        ---              --------------       --------
|                     |                  |                    |                  |
|                     |                  |                    |                  |
| (1) Start Flow      |                  |                    |                  |
|--------------------&gt;|                  |                    |                  |
|                     | (2) Native Authorization Request      |                  |
|                     |-----------------&gt;|                    |                  |
|                     | (3) Authorization Error Response      |                  |
|                     |   (insufficient_authorization,        |                  |
|                     |     dc_credential_required)           |                  |
|                     |&lt;-----------------|                    |                  |
|                     |                  |                    |                  |
+===================== DC API branch ============================================+
|                     | (4) Presentation Request (OID4VP)     |                  |
|                     |--------------------------------------&gt;|                  |
|                     | (5) Presentation Response (vp_token)  |                  |
|                     |&lt;--------------------------------------|                  |
|                     | (6) vp_token                          |                  |
|                     |-----------------&gt;|                    |                  |
|                     |                  | (7) vp_token       |                  |
|                     |                  |--------------------------------------&gt;|
|                     |                  | (8) Verification Result               |
|                     |                  |&lt;--------------------------------------|
+================================================================================+
+=================== No DC API branch ===========================================+
|------- Same device path -------------------------------------------------------|
|                     | (9) Invoke Wallet via Deeplink        |                  |
|                     |--------------------------------------&gt;|                  |
|                     |                  |                    | (10) Presentation Response (vp_token)
|                     |                  |                    |-----------------&gt;|
|                     |                  | (11) redirect_uri_client?handle       |
|                     |                  |&lt;--------------------------------------|
|                     | (12) Redirect to client w/ openid4vp_redirect_uri?handle=123
|                     |&lt;--------------------------------------|                  |
|                     | (13) Handle                           |                  |
|                     |-----------------&gt;|                    |                  |
|                     |                  | (14) Get Presentation Result          |
|                     |                  |--------------------------------------&gt;|
|                     |                  | (15) Presentation Result              |
|                     |                  |&lt;--------------------------------------|
|------- Cross device path ------------------------------------------------------|
| (16) Display QR Code|                  |                    |                  |
|&lt;--------------------|                  |                    |                  |
| (17) Scan QR Code   |                  |                    |                  |
|-----------------------------------------------------------&gt;&gt;|                  |
|                     |                  |                    | (18) Presentation Response (vp_token)
|                     |                  |                    |-----------------&gt;|
|                     +---- Loop ------------------------------------------------+
|                     | (19) Poll for authorization response                     |
|                     |-----------------&gt;|                                       |
|                     |                  | (20) Get Presentation Result          |
|                     |                  |&lt;-------------------------------------&gt;|
|                     |                  | (21) Pending                          |
|                     |                  |&lt;--------------------------------------|
|                     | (22) Pending     |                                       |
|                     |&lt;-----------------|                                       |
|                     +---- Break when presentation done ------------------------|
|                     |                  | (23) Presentation Result              |
|                     |                  |&lt;--------------------------------------|
+================================================================================+
|                     |                  |
|  Note: Assuming the happy path. In case of error, error responses are sent back accordingly.
|                     |                  |
|                     | (24) Code        |
|                     |&lt;-----------------|
|                     | (25) Token Request w/ code
|                     |-----------------&gt;|
|                     | (26) Tokens      |
|                     |&lt;-----------------|
|                     |                  |
</pre><a href="#appendix-A.2-2" class="pilcrow">¶</a>
</div>
<p id="appendix-A.2-3">The verifier is displayed here as a separate instance, but can also be part of the authorization server. In both cases, it is transparent to the client, as the client only talks to the authorization server's Native Authorization Endpoint (<a href="#native-authorization-endpoint" class="auto internal xref">Section 4.1</a>).<a href="#appendix-A.2-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-A.2-4">
<li id="appendix-A.2-4.1">
            <p id="appendix-A.2-4.1.1">User opens app<a href="#appendix-A.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.2">
            <p id="appendix-A.2-4.2.1">The client indicates, as part of the Native Authorization Request (<a href="#native-auth-request" class="auto internal xref">Section 4.2</a>), the following:<a href="#appendix-A.2-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-4.2.2.1">
                <p id="appendix-A.2-4.2.2.1.1">Login via digital credentials (wallet) desired<a href="#appendix-A.2-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.2-4.2.2.2">
                <p id="appendix-A.2-4.2.2.2.1">DC API support<a href="#appendix-A.2-4.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.2-4.2.2.3">
                <p id="appendix-A.2-4.2.2.3.1">Same device/cross device (only, if DC API is not supported)<a href="#appendix-A.2-4.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.2-4.2.2.4">
                <p id="appendix-A.2-4.2.2.4.1">a redirect URI intended for redirect from a wallet to the client in <span>[<a href="#OpenID4VP" class="cite xref">OpenID4VP</a>]</span> same device flows (hereafter called openid4vp_redirect_uri)<a href="#appendix-A.2-4.2.2.4.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2-4.2.2.4.2">
<pre>
POST /native-authorization HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

&amp;client_id=bb16c14c73415
&amp;scope=profile
&amp;dc_api=false
&amp;login_hint=wallet
&amp;openid4vp_flow_type=same_device
&amp;openid4vp_redirect_uri=https%3A%2F%2Fdeeplink.example.client
</pre><a href="#appendix-A.2-4.2.2.4.2" class="pilcrow">¶</a>
</div>
</li>
            </ul>
<p id="appendix-A.2-4.2.3">
Note that the client may collect this information from the user before making the initial request, or provide what it knows initially and respond gradually to additional requests for information from the authorization server.<a href="#appendix-A.2-4.2.3" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.3">
            <p id="appendix-A.2-4.3.1">Authorization server returns with error response (insufficient_authorization), indicating in the response body that digital credential presentation is required. The authorization server's response may look like this:<a href="#appendix-A.2-4.3.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2-4.3.2">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store

{
  "error": "insufficient_authorization",
  "auth_session": "ce6772f5e07bc8361572f",
  "type": "digital_credentials_required",
  "request": "openid4vp://?request_uri=..." // omitted if the authorization server cannot yet return the presentation request
}
</pre><a href="#appendix-A.2-4.3.2" class="pilcrow">¶</a>
</div>
</li>
          <li id="appendix-A.2-4.4">
            <p id="appendix-A.2-4.4.1">Client invokes the DC API.<a href="#appendix-A.2-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.5">
            <p id="appendix-A.2-4.5.1">The DC API returns the vp_token to the client<a href="#appendix-A.2-4.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.6">
            <p id="appendix-A.2-4.6.1">Client sends vp_token to the authorization server<a href="#appendix-A.2-4.6.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2-4.6.2">
<pre>
 POST /native-authorization HTTP/1.1
 Host: server.example.com
 Content-Type: application/json

 {
   "auth_session": "ce6772f5e07bc8361572f",
   "vp_token": "....."
 }
</pre><a href="#appendix-A.2-4.6.2" class="pilcrow">¶</a>
</div>
</li>
          <li id="appendix-A.2-4.7">
            <p id="appendix-A.2-4.7.1">The authorization server asks the verifier to verify the vp_token<a href="#appendix-A.2-4.7.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.8">
            <p id="appendix-A.2-4.8.1">The verifier verifies the vp_token and returns the result. The authorization server evaluates the verification result and returns either a code or an error as per <a href="#native-response" class="auto internal xref">Section 4.3</a>. Here we assume the happy path. Continue with step 24.<a href="#appendix-A.2-4.8.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.9">
            <p id="appendix-A.2-4.9.1">If DC API is NOT supported and in case of same device flow, the client invokes the Wallet through Deep Link.<a href="#appendix-A.2-4.9.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.10">
            <p id="appendix-A.2-4.10.1">Wallet presents credentials to verifier.<a href="#appendix-A.2-4.10.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.11">
            <p id="appendix-A.2-4.11.1">Verifier responds with a URL instructing wallet to redirect as per <span>[<a href="#OpenID4VP" class="cite xref">OpenID4VP</a>]</span>.<a href="#appendix-A.2-4.11.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.12">
            <p id="appendix-A.2-4.12.1">Wallet redirects back to the client using the received URL as a Deep Link.<a href="#appendix-A.2-4.12.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.13">
            <p id="appendix-A.2-4.13.1">Client extracts the handle from the received URL and provides it to the authorization server.<a href="#appendix-A.2-4.13.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2-4.13.2">
<pre>
POST /native-authorization HTTP/1.1
Host: server.example.com
Content-Type: application/json

{
  "auth_session": "ce6772f5e07bc8361572f",
  "presentation_id" : "87248924n2f"
}
</pre><a href="#appendix-A.2-4.13.2" class="pilcrow">¶</a>
</div>
</li>
          <li id="appendix-A.2-4.14">
            <p id="appendix-A.2-4.14.1">The authorization server uses the handle at verifier to look retrieve the presentation result.<a href="#appendix-A.2-4.14.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.15">
            <p id="appendix-A.2-4.15.1">The verifier responds with the presentation result which the authorization server evaluates, then returns either a code or an error as per <a href="#native-response" class="auto internal xref">Section 4.3</a>. Here we assume the happy path. Continue with step 24.<a href="#appendix-A.2-4.15.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.16">
            <p id="appendix-A.2-4.16.1">If DC API is NOT supported and in case of cross device, the client renders the presentation request as QR code and displays it to the user.<a href="#appendix-A.2-4.16.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.17">
            <p id="appendix-A.2-4.17.1">The user scans the QR code with the wallet.<a href="#appendix-A.2-4.17.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.18">
            <p id="appendix-A.2-4.18.1">The wallet presents the credentials to the verifier.<a href="#appendix-A.2-4.18.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.19">
            <p id="appendix-A.2-4.19.1">Meanwhile, client polls the authorization server for the presentation status until it receives a non-pending result.<a href="#appendix-A.2-4.19.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2-4.19.2">
<pre>
POST /native-authorization HTTP/1.1
Host: server.example.com
Content-Type: application/json

{
  "auth_session": "ce6772f5e07bc8361572f"
}
</pre><a href="#appendix-A.2-4.19.2" class="pilcrow">¶</a>
</div>
</li>
          <li id="appendix-A.2-4.20">
            <p id="appendix-A.2-4.20.1">The authorization server in turn retreives the presentation status from the verifier.<a href="#appendix-A.2-4.20.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.21">
            <p id="appendix-A.2-4.21.1">The verifier responds to the authorization server that the presentation result is not yet ready.<a href="#appendix-A.2-4.21.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.22">
            <p id="appendix-A.2-4.22.1">The authorization server responds to the client that the presentation result is not yet ready.<a href="#appendix-A.2-4.22.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2-4.22.2">
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store

{
  "error": "insufficient_authorization",
  "status": "pending",
  "auth_session": "ce6772f5e07bc8361572f"
}
</pre><a href="#appendix-A.2-4.22.2" class="pilcrow">¶</a>
</div>
</li>
          <li id="appendix-A.2-4.23">
            <p id="appendix-A.2-4.23.1">Once the presentation is done, the verifier returns the result to the authorization server, which then evaluates the verification result and returns either a code or an error as per <a href="#native-response" class="auto internal xref">Section 4.3</a>, breaking the loop. Here we assume the happy path. Continue with step 24.<a href="#appendix-A.2-4.23.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.24">
            <p id="appendix-A.2-4.24.1">The authorization server returns an authorization code to the client as per <a href="#native-response" class="auto internal xref">Section 4.3</a>.<a href="#appendix-A.2-4.24.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.25">
            <p id="appendix-A.2-4.25.1">The client redeems the code for an access token.<a href="#appendix-A.2-4.25.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-4.26">
            <p id="appendix-A.2-4.26.1">The authorization server responds to the token request.<a href="#appendix-A.2-4.26.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div id="rar-transaction-data">
<section id="appendix-A.2.1">
          <h4 id="name-rar-transaction-data">
<a href="#appendix-A.2.1" class="section-number selfRef">A.2.1. </a><a href="#name-rar-transaction-data" class="section-name selfRef">RAR &amp; Transaction Data</a>
          </h4>
<p id="appendix-A.2.1-1"><span>[<a href="#OpenID4VP" class="cite xref">OpenID4VP</a>]</span> supports transaction data, which is additional data to be signed and presented alongside the requested credentials. This can be mapped to RAR <span>[<a href="#RFC9396" class="cite xref">RFC9396</a>]</span>. The following diagram depicts a wallet flow incorporating RAR. Details of how the wallet is invoked or how the presentation result reaches the authorization server are omitted for simplicity. Refer to <a href="#digital-credentials" class="auto internal xref">Appendix A.2</a> for details.<a href="#appendix-A.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-ascii-art art-text artwork" id="appendix-A.2.1-2">
<pre>
First Party Client        AS              Wallet/DC API       Verifier
------------------        ---              --------------       --------
|                          |                    |                  |
| (1) Native Authorization Request w/ RAR       |                  |
|-------------------------&gt;|                    |                  |
|                          | (2) Create Presentation request (OIDC4VP) w/ tx_data
|                          |--------------------------------------&gt;|
|                          | (3) Presentation request (OIDC4VP)    |
|                          |&lt;--------------------------------------|
| (4) Presentation request (OIDC4VP)            |                  |
|&lt;-------------------------|                    |                  |
| (5) Presentation Request (OIDC4VP)            |                  |
|----------------------------------------------&gt;|                  |
|                          |                    | (6) Presentation Response (vp_token)
|                          |                    |-----------------&gt;|
|                          | (7) Presentation Result               |
|                          |&lt;--------------------------------------|
| (8) code                |
|&lt;-------------------------|
| (9) Token Request w/ code
|-------------------------&gt;|
| (10) Token Response w/ RAR
|&lt;-------------------------|
</pre><a href="#appendix-A.2.1-2" class="pilcrow">¶</a>
</div>
<ol start="1" type="1" class="normal type-1" id="appendix-A.2.1-3">
<li id="appendix-A.2.1-3.1">
              <p id="appendix-A.2.1-3.1.1">The client initiates the OAuth request, including RAR.<a href="#appendix-A.2.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.2">
              <p id="appendix-A.2.1-3.2.1">The authorization server processes that RAR from the request and creates a transaction data object from it. The authorization server then sends a request including the transaction data to the verifier to create a presentation request.<a href="#appendix-A.2.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.3">
              <p id="appendix-A.2.1-3.3.1">The verifier responds with the presentation request.<a href="#appendix-A.2.1-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.4">
              <p id="appendix-A.2.1-3.4.1">The authorization server responds to client with the presentation request.<a href="#appendix-A.2.1-3.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.5">
              <p id="appendix-A.2.1-3.5.1">The client invokes the wallet. How exactly the wallet is invoked is omitted for simplicity. See Usage with Digital Credentials <a href="#digital-credentials" class="auto internal xref">Appendix A.2</a> for details.<a href="#appendix-A.2.1-3.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.6">
              <p id="appendix-A.2.1-3.6.1">The wallet creates a vp_token including the requested transaction data and sends it to the verifier.<a href="#appendix-A.2.1-3.6.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.7">
              <p id="appendix-A.2.1-3.7.1">The verifier verifies the vp_token and eventually the authorization server learns about the result. How the authorization server learns about the result is omitted for simplicity. See Usage with Digital Credentials <a href="#digital-credentials" class="auto internal xref">Appendix A.2</a> for details. The authorization server then evaluates the result, especially the transaction data.<a href="#appendix-A.2.1-3.7.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.8">
              <p id="appendix-A.2.1-3.8.1">The authorization server returns an authorization code to the client as per <a href="#native-response" class="auto internal xref">Section 4.3</a>.<a href="#appendix-A.2.1-3.8.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.9">
              <p id="appendix-A.2.1-3.9.1">The client redeems the code for an access token.<a href="#appendix-A.2.1-3.9.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-A.2.1-3.10">
              <p id="appendix-A.2.1-3.10.1">The authorization server responds to the token request. It also includes the authorization_details.<a href="#appendix-A.2.1-3.10.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2.1-3.10.2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store

{
  "access_token": "2YotnFZFEjr1zCsicMWpAA",
  "token_type": "Bearer",
  "expires_in": 3600,
  "authorization_details": [
    {
      "type": "account_information",
      "access": {
        "accounts": [
          {
            "iban": "DE2310010010123456789"
          },
          {
            "maskedPan": "123456xxxxxx1234"
          }
        ],
        "balances": [
          {
            "iban": "DE2310010010123456789"
          }
        ],
        "transactions": [
          {
            "iban": "DE2310010010123456789"
          },
          {
            "maskedPan": "123456xxxxxx1234"
          }
        ]
      },
      "recurringIndicator": true
    }
  ]
}
</pre><a href="#appendix-A.2.1-3.10.2" class="pilcrow">¶</a>
</div>
</li>
          </ol>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="document-history">
<section id="appendix-B">
      <h2 id="name-document-history">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-document-history" class="section-name selfRef">Document History</a>
      </h2>
<p id="appendix-B-1">-00<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-2.1">
          <p id="appendix-B-2.1.1">Document creation<a href="#appendix-B-2.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">The authors would like to thank the attendees of IETFs 123 &amp; 124 in which this was discussed, as well as the following individuals who contributed ideas, feedback, and wording that shaped and formed the final specification: George Fletcher, Arndt Schwenkshuster, Filip Skokan.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yaron Zehavi</span></div>
<div dir="auto" class="left"><span class="org">Raiffeisen Bank International</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:yaron.zehavi@rbinternational.com" class="email">yaron.zehavi@rbinternational.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Aaron Parecki</span></div>
<div dir="auto" class="left"><span class="org">Okta</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:aaron@parecki.com" class="email">aaron@parecki.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
